= MarbleRun Keyboard Layout
Florian Walpen <dev@submerge.ch>
:toc:

== Introduction

MarbleRun presents a novel keyboard layout tailored for standard keyboards, aiming to enhance typing efficiency across English text and programming contexts.
The primary objective of MarbleRun is to reduce the overall typing effort required.
Its layout prioritizes hand alternation and facilitates smooth finger rolls during typing sequences.
Optimized using a sophisticated typing work model based on hand anatomy, this results in a comfortable and ergonomic typing experience.

=== The Layout

image::MarbleRun.png[]

MarbleRun differs substantially from the standard QWERTY keyboard layout:

* Alphabet letters are placed in a completely different order.
* Comparison and logic symbols are consolidated in the number row.
* Underscores and asterisks are relocated to the alphabet rows.
* Parentheses, brackets and punctuation change both position and shift partners.

Although some adjustments were made manually, the primary arrangement within the alphabet rows was determined through a heuristic search across all possible layouts.
This means the placement decisions were guided by the cost function that was minimized in the search, which is the estimated typing work according to our model.
While we cannot follow the rationale behind each placement choice, we can examine the typing work model to get some basic understanding.

=== Home Row

A little ergonomics experiment first:

Let your arms hang down at the side of your body, all relaxed including hands and fingers.
Close your eyes.
Now carefully place your fingertips on a flat surface, as if you would be typing there.
Make sure your hands and fingers are still fully relaxed.
Open your eyes and observe where your fingertips landed.
This is your actual "home row" in relaxed position.

Traditionally, the home row has been defined as four keys for each hand in the middle row.
In my observations, the middle and ring finger settle about half a key above the middle row, when relaxed.
Therefore the "home row" should also consider keys from the upper row:

image::HomeRow.png[]

This is just the starting point for the ergonomics considered in MarbleRun, and the typing work model derived from that.

=== Installation

Windows::
Please download the Microsoft Keyboard Layout Creator to open the link:Windows/MarbleRun/MarbleRun.klc[MarbleRun.klc] file from this repo.
It will create keyboard layouts with installers, make sure to choose the right architecture (typically amd64).
For convenience, there are also ready-made installers in a subfolder of this repo, but it is bad practice security-wise.

Xorg and Wayland::
Patching the keyboard layouts system-wide is the most convenient and reliable option currently, sorry about that.
Patches can be found in the `xkb` directory of this repo, for the `rules/base.xml`, `rules/evdev.xml` and `symbols/us` files of the xkb package.
MarbleRun will then be available as a US keyboard layout variant.


== Ergonomics

=== Design Principles

For a critique of the standard QWERTY layout and its core issues, I recommend to read the Wikipedia article on link:https://en.wikipedia.org/wiki/Dvorak_keyboard_layout[Dvorak keyboard layout].
MarbleRun shares some of the design principles with Dvorak, although the definition of home row is different:

----
Letters should be typed by alternating between hands.
----

----
For maximum speed and efficiency, the most common letters and bigrams should be typed on the home row.
----

Noteworthy parallels with Dvorak include the arrangement of vowels on the left hand side.
In case of MarbleRun, this solution was found through heuristic search, as a consequence of the typing work model favoring hand alternation.

Some design principles of Dvorak were decidedly *not* applied to MarbleRun:

----
The least common letters should be on the bottom row which is the hardest row to reach.
----
That is only true for the middle and ring fingers, which naturally rest further away from the bottom row.
----
The right hand should do more of the typing because most people are right-handed.
----
This may help adoption, but goes against efficiency and universality.
----
Bigrams should not be typed with adjacent fingers.
----
For trained touch typists this is not a problem, unless the keys are too close together.
----
Stroking should generally move from the edges of the board to the middle.
----
Again, this is just a matter of training, think of piano players routinely stroking outwards.

Instead, the design of MarbleRun relies on an explicit typing work model, to quantify what is efficient and ergonomic to reach.
It expresses the movement and work needed to type a sequence of keys.
The work is mostly linear with the distance traveled by hand and fingers, but there are exceptions.
Apart from hand alternation, finger rolls influence the estimated typing work in a positive way.

=== Finger Rolls

While typing multiple keys with a single hand, we observe that certain pairs of keys are in comfortable reach of each other and rather effortless to press.
These pairs, known as _finger rolls_, enable rapid keystrokes, as one finger can initiate the press on the second key while the other finger is still releasing the first key.

In the MarbleRun typing work model, finger rolls are characterized by the following criteria:

* The two keys are pressed by different fingers of the same hand.
* The second key can be comfortably reached while holding the first key.

While the first criterion is trivial, determining comfortable reach requires a closer examination of hand anatomy.
It's essential to note that we only consider the relative positions of keys to each other, allowing the hand to move freely across the keyboard without being constrained to the home row.
Since we neglect the hand position here, this approach leaves us with three degrees of freedom: Individual finger reach, finger spread, and wrist angle.

Here is an opportunity to conduct another simple self-experiment:
Hold your typing hand at the wrist to fix it, and evaluate the reach of your fingers.
Confirm that the keys you claim to reach are indeed comfortable to press.

The range of an individual finger is surprisingly limited in the context of typing.
For MarbleRun, finger rolls encompass the combined forward and backward ranges of involved fingers, with the hand positioned to comfortably access both keys.

In addition to the flexibility of finger joints, fingers can also spread.
This greatly extends the horizontal range for finger rolls.
The index finger spreads notably further than the other fingers. Given its pivot this lets it reach well into the middle of the bottom row on the keyboard.

Lastly, the angle of the whole hand, induced by horizontal wrist tilt, provides an additional degree of freedom.
Although comfortable within narrow limits, it contributes to the overall finger range.
In particular, it allows finger rolls such as the index finger in the bottom row while the little finger is in the middle row of the keyboard.

